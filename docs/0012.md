# Java 8 æ–¹æ³•å¼•ç”¨ï¼ŒåŒå†’å·(::)è¿ç®—ç¬¦

> åŸæ–‡:[http://web . archive . org/web/20230101150211/https://mkyong . com/Java 8/Java-8-method-references-double-colon-operator/](http://web.archive.org/web/20230101150211/https://mkyong.com/java8/java-8-method-references-double-colon-operator/)

åœ¨ Java 8 ä¸­ï¼ŒåŒå†’å·(::)æ“ä½œç¬¦è¢«ç§°ä¸ºæ–¹æ³•å¼•ç”¨ã€‚å‚è€ƒä¸‹é¢çš„ä¾‹å­:

æ‰“å°åˆ—è¡¨çš„åŒ¿åç±»ã€‚

```
 List<String> list = Arrays.asList("node", "java", "python", "ruby");
list.forEach(new Consumer<String>() {       // anonymous class
    @Override
    public void accept(String str) {
        System.out.println(str);
    }
}); 
```

åŒ¿åç±»-> Lambda è¡¨è¾¾å¼ã€‚

```
 List<String> list = Arrays.asList("node", "java", "python", "ruby");
list.forEach(str -> System.out.println(str)); // lambda 
```

Lambda è¡¨è¾¾å¼->æ–¹æ³•å¼•ç”¨ã€‚

```
 List<String> list = Arrays.asList("node", "java", "python", "ruby");
list.forEach(System.out::println);          // method references 
```

**åŒ¿åç±»->Î»è¡¨è¾¾å¼- >æ–¹æ³•å¼•ç”¨**

**æ³¨æ„**
lambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨ä»€ä¹ˆéƒ½ä¸åšï¼Œåªæ˜¯å¯¹ç°æœ‰æ–¹æ³•çš„å¦ä¸€ç§æ–¹å¼è°ƒç”¨ã€‚é€šè¿‡æ–¹æ³•å¼•ç”¨ï¼Œå®ƒè·å¾—äº†æ›´å¥½çš„å¯è¯»æ€§ã€‚

æœ‰å››ç§æ–¹æ³•å¼•ç”¨:

*   å¯¹é™æ€æ–¹æ³•çš„å¼•ç”¨`ClassName::staticMethodName`
*   å¼•ç”¨ç‰¹å®šå¯¹è±¡çš„å®ä¾‹æ–¹æ³•`Object::instanceMethodName`
*   å¼•ç”¨ç‰¹å®šç±»å‹çš„ä»»æ„å¯¹è±¡çš„å®ä¾‹æ–¹æ³•`ContainingType::methodName`â€“
*   å¯¹æ„é€ å‡½æ•°çš„å¼•ç”¨`ClassName::new`

## 1.é™æ€æ³•

Î»è¡¨è¾¾å¼ã€‚

```
 (args) -> ClassName.staticMethodName(args) 
```

æ–¹æ³•å‚è€ƒã€‚

```
 ClassName::staticMethodName 
```

1.1 è¿™ä¸ªä¾‹å­æ‰“å°ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ–¹æ³•å¼•ç”¨ä¸€ä¸ªé™æ€æ–¹æ³•`SimplePrinter::print`ã€‚

Java8MethodReference1a.java

```
 package com.mkyong;

import java.util.Arrays;
import java.util.List;
import java.util.function.Consumer;

public class Java8MethodReference1a {

    public static void main(String[] args) {

        List<String> list = Arrays.asList("A", "B", "C");

        // anonymous class
        list.forEach(new Consumer<String>() {
            @Override
            public void accept(String x) {
                SimplePrinter.print(x);
            }
        });

        // lambda expression
        list.forEach(x -> SimplePrinter.print(x));

        // method reference
        list.forEach(SimplePrinter::print);

    }

}

class SimplePrinter {
    public static void print(String str) {
        System.out.println(str);
    }
} 
```

1.2 è¿™ä¸ªä¾‹å­å°†ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨è½¬æ¢æˆä¸€ä¸ªæ•´æ•°åˆ—è¡¨ï¼Œæ–¹æ³•å¼•ç”¨ä¸€ä¸ªé™æ€æ–¹æ³•`Integer::parseInt`ã€‚

Integer.java

```
 public static int parseInt(String s) throws NumberFormatException {
        return parseInt(s,10);
  } 
```

Java8MethodReference1b.java

```
 package com.mkyong;

import java.util.Arrays;
import java.util.List;
import java.util.function.Function;
import java.util.stream.Collectors;

public class Java8MethodReference1b {

    public static void main(String[] args) {

        List<String> list = Arrays.asList("1", "2", "3");

        // anonymous class
        List<Integer> collect1 = list.stream()
                .map(new Function<String, Integer>() {
                    @Override
                    public Integer apply(String s) {
                        return Integer.parseInt(s);
                    }
                })
                .collect(Collectors.toList());

        // lambda expression
        List<Integer> collect2 = list.stream()
                .map(s -> Integer.parseInt(s))
                .collect(Collectors.toList());

        // method reference
        List<Integer> collect3 = list.stream()
                .map(Integer::parseInt)
                .collect(Collectors.toList());

    }

} 
```

1.3 æ­¤ç¤ºä¾‹è¿æ¥ä¸¤ä¸ª`Integer`å¹¶è¿”å›ä¸€ä¸ª`String`ã€‚å®ƒå°†æ–¹æ³•å¼•ç”¨é™æ€æ–¹æ³•`IntegerUtils::join`ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªæ¥å—`BiFunction`çš„æ–¹æ³•ã€‚

Java8MethodReference1c.java

```
 package com.mkyong;

import java.util.function.BiFunction;

public class Java8MethodReference1c {

    public static void main(String[] args) {

        // anonymous class
        String result1 = playTwoArgument(1, 2, new BiFunction<Integer, Integer, String>() {
                  @Override
                  public String apply(Integer a, Integer b) {
                      return IntegerUtils.join(a, b);
                  }
              });                                                                   // 3

        // lambda
        String result1 = playTwoArgument(1, 2, (a, b) -> IntegerUtils.join(a, b));  // 3

        // method reference
        String result2 = playTwoArgument(1, 2, IntegerUtils::join);                 // 3

    }

    private static <R> R playTwoArgument(Integer i1, Integer i2,
        BiFunction<Integer, Integer, R> func) {
        return func.apply(i1, i2);
    }

}

class IntegerUtils{

    public static String join(Integer a, Integer b) {
        return String.valueOf(a + b);
    }

} 
```

## 2.å¯¹ç‰¹å®šå¯¹è±¡çš„å®ä¾‹æ–¹æ³•çš„å¼•ç”¨

Î»è¡¨è¾¾å¼ã€‚

```
 (args) -> object.instanceMethodName(args) 
```

æ–¹æ³•å‚è€ƒã€‚

```
 object::instanceMethodName 
```

2.1 è¿™ä¸ªä¾‹å­æŒ‰ç…§è–ªæ°´å¯¹ä¸€ä¸ª`Employee`åˆ—è¡¨è¿›è¡Œæ’åºã€‚æˆ‘ä»¬å¯ä»¥å¼•ç”¨ä¸€ä¸ªç‰¹å®šå¯¹è±¡`ComparatorProvider`çš„å®ä¾‹æ–¹æ³•`compareBySalary`ã€‚

Java8MethodReference2

```
 package com.mkyong;

import java.math.BigDecimal;
import java.util.Arrays;
import java.util.List;

public class Java8MethodReference2 {

    public static void main(String[] args) {

        List<Employee> list = Arrays.asList(
                new Employee("mkyong", 38, BigDecimal.valueOf(3800)),
                new Employee("zilap", 5, BigDecimal.valueOf(100)),
                new Employee("ali", 25, BigDecimal.valueOf(2500)),
                new Employee("unknown", 99, BigDecimal.valueOf(9999)));

        // anonymous class
        /*list.sort(new Comparator<Employee>() {
            @Override
            public int compare(Employee o1, Employee o2) {
                return provider.compareBySalary(o1, o2);
            }
        });*/

        ComparatorProvider provider = new ComparatorProvider();

        // lambda
        // list.sort((o1, o2) -> provider.compareBySalary(o1, o2));

        // method reference
        list.sort(provider::compareBySalary);

        list.forEach(x -> System.out.println(x));

    }

}

class ComparatorProvider {

    public int compareByAge(Employee o1, Employee o2) {
        return o1.getAge().compareTo(o2.getAge());
    }

    public int compareByName(Employee o1, Employee o2) {
        return o1.getName().compareTo(o2.getName());
    }

    public int compareBySalary(Employee o1, Employee o2) {
        return o1.getAge().compareTo(o2.getAge());
    }

} 
```

Employee.java

```
 package com.mkyong;

import java.math.BigDecimal;

public class Employee {

    String name;
    Integer age;
    BigDecimal salary;

    // generated by IDE, getters, setters, constructor, toString
} 
```

è¾“å‡º

```
 Employee{name='zilap', age=5, salary=100}
Employee{name='ali', age=25, salary=2500}
Employee{name='mkyong', age=38, salary=3800}
Employee{name='unknown', age=99, salary=9999} 
```

## 3.å¯¹ç‰¹å®šç±»å‹çš„ä»»æ„å¯¹è±¡çš„å®ä¾‹æ–¹æ³•çš„å¼•ç”¨ã€‚

è¿™ç§è¯´æ³•æœ‰ç‚¹æ··ä¹±ï¼Œä¸éœ€è¦ä»€ä¹ˆè§£é‡Šï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­:

Î»è¡¨è¾¾å¼ã€‚

```
 // arg0 is the first argument
(arg0, rest_of_args) -> arg0.methodName(rest_of_args)

// example, assume a and b are String
(a, b) -> a.compareToIgnoreCase(b) 
```

æ–¹æ³•å‚è€ƒã€‚

```
 // first argument type
arg0_Type::methodName

// arg0 is type of ClassName
ClassName::methodName

// example, a is type of String
String::compareToIgnoreCase 
```

å¯¹äº`(String a, String b)`ï¼Œå…¶ä¸­`a`å’Œ`b`ä¸ºä»»æ„åç§°ï¼Œ`String`ä¸ºå…¶ä»»æ„ç±»å‹ã€‚è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†å¯¹ç‰¹å®šç±»å‹`String`çš„ä»»æ„å¯¹è±¡`a`(ç¬¬ä¸€ä¸ªå‚æ•°)çš„å®ä¾‹æ–¹æ³•`compareToIgnoreCase`çš„æ–¹æ³•å¼•ç”¨ã€‚

3.1 æŸ¥çœ‹æœ¬[æ–¹æ³•å‚è€ƒ](http://web.archive.org/web/20220801141236/https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html)ä¸­çš„æ­£å¼ç¤ºä¾‹

```
 String[] stringArray = { "Barbara", "James", "Mary", "John",
                "Patricia", "Robert", "Michael", "Linda" };
  Arrays.sort(stringArray, String::compareToIgnoreCase); 
```

æˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ªæ–¹æ³•å¼•ç”¨`String::compareToIgnoreCase`ä½œä¸º`Arrays.sort`çš„æ¯”è¾ƒå™¨ã€‚

**è®²è§£**
å¤ä¹ `Arrays.sort`æ–¹æ³•ç­¾å:

```
 public static <T> void sort(T[] a, Comparator<? super T> c) {
} 
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`Arrays.sort`æœŸæœ›ä¸€ä¸ª`Comparator<String>`ã€‚`Comparator`æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œå®ƒçš„æŠ½è±¡æ–¹æ³•`compare`åŒ¹é…`BiFunction<String, String, Integer>`ï¼Œå®ƒå¸¦ä¸¤ä¸ªå‚æ•°`String`å¹¶è¿”å›ä¸€ä¸ª`int`ã€‚

Comparator.java

```
 @FunctionalInterface
public interface Comparator<T> {
    int compare(T o1, T o2);  // this matches BiFunction<String, String, Integer>
} 
```

æŸ¥çœ‹`BiFunction`æ–¹æ³•ç­¾å:

BiFunction.java

```
 @FunctionalInterface
public interface BiFunction<T, U, R> {
      R apply(T t, U u);
} 
```

**å»¶ä¼¸é˜…è¯»â€”â€”**[Java 8 åŒå‡½æ•°ç¤ºä¾‹](/web/20220801141236/https://mkyong.com/java8/java-8-bifunction-examples/)

below lambda ä¸º`BiFunction<String,String,Integer>`æä¾›äº†å®ç°ï¼Œå› æ­¤`Arrays.sort`æ¥å— below lambda è¡¨è¾¾å¼ä½œä¸ºæœ‰æ•ˆè¯­æ³•ã€‚

```
 (String a, String b) -> a.compareToIgnoreCase(b) // return int

// a is type of String
// method reference
String::compareToIgnoreCase 
```

3.2 è®©æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªä¾‹å­ã€‚

Java8MethodReference3a.java

```
 package com.mkyong;

import java.util.function.BiPredicate;
import java.util.function.Function;

public class Java8MethodReference3a {

    public static void main(String[] args) {

        // lambda
        int result = playOneArgument("mkyong", x -> x.length());   // 6

        // method reference
        int result2 = playOneArgument("mkyong", String::length);   // 6

        // lambda
        Boolean result3 = playTwoArgument("mkyong", "y", (a, b) -> a.contains(b)); // true

        // method reference
        Boolean result4 = playTwoArgument("mkyong", "y", String::contains);        // true

        // lambda
        Boolean result5 = playTwoArgument("mkyong", "1", (a, b) -> a.startsWith(b)); // false

        // method reference
        Boolean result6 = playTwoArgument("mkyong", "y", String::startsWith);        // false

        System.out.println(result6);
    }

    static <R> R playOneArgument(String s1, Function<String, R> func) {
        return func.apply(s1);
    }

    static Boolean playTwoArgument(String s1, String s2, BiPredicate<String, String> func) {
        return func.test(s1, s2);
    }

} 
```

3.3 è®©æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼Œè‡ªå®šä¹‰å¯¹è±¡ã€‚

Java8MethodReference3b.java

```
 package com.mkyong;

import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.function.BiFunction;

public class Java8MethodReference3b {

    public static void main(String[] args) {

        Invoice obj = new Invoice("A001", BigDecimal.valueOf(1.99), 3);

        InvoiceCalculator formula = new InvoiceCalculator();

        // lambda
        BigDecimal result = calculate(formula, obj, (f, o) -> f.normal(o));         // 5.97

        // method reference
        BigDecimal result2 = calculate(formula, obj, InvoiceCalculator::normal);    // 5.97

        // lambda
        BigDecimal result3 = calculate(formula, obj, (f, o) -> f.promotion(o));     // 5.37

        // method reference
        BigDecimal result4 = calculate(formula, obj, InvoiceCalculator::promotion); // 5.37

    }

    static BigDecimal calculate(InvoiceCalculator formula, Invoice s1,
                                BiFunction<InvoiceCalculator, Invoice, BigDecimal> func) {
        return func.apply(formula, s1);
    }

}

class InvoiceCalculator {

    public BigDecimal normal(Invoice obj) {
        return obj.getUnitPrice().multiply(BigDecimal.valueOf(obj.qty));
    }

    public BigDecimal promotion(Invoice obj) {
        return obj.getUnitPrice()
                .multiply(BigDecimal.valueOf(obj.qty))
                .multiply(BigDecimal.valueOf(0.9))
                .setScale(2, RoundingMode.HALF_UP);
    }
}

class Invoice {

    String no;
    BigDecimal unitPrice;
    Integer qty;

    // generated by IDE, setters, gettes, constructor, toString
} 
```

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ç§ç±»å‹çš„`InvoiceCalculator`ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¼•ç”¨ç‰¹å®šç±»å‹`InvoiceCalculator`çš„ä»»æ„å¯¹è±¡`f`çš„å®ä¾‹æ–¹æ³•(`normal or promotion`)ã€‚

```
 (f, o) -> f.normal(o))
(f, o) -> f.promotion(o))

InvoiceCalculator::normal
InvoiceCalculator::promotion 
```

æ˜ç™½äº†å—ï¼Ÿæ²¡æœ‰æ›´å¤šçš„ä¾‹å­ğŸ™‚

## 4.å¯¹æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚

Î»è¡¨è¾¾å¼ã€‚

```
 (args) -> new ClassName(args) 
```

æ–¹æ³•å‚è€ƒã€‚

```
 ClassName::new 
```

4.1 å¯¹é»˜è®¤æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚

Java8MethodReference4a.java

```
 package com.mkyong;

import java.math.BigDecimal;
import java.util.HashMap;
import java.util.Map;
import java.util.function.Supplier;

public class Java8MethodReference4a {

    public static void main(String[] args) {

        // lambda
        Supplier<Map> obj1 = () -> new HashMap();   // default HashMap() constructor
        Map map1 = obj1.get();

        // method reference
        Supplier<Map> obj2 = HashMap::new;
        Map map2 = obj2.get();

        // lambda
        Supplier<Invoice> obj3 = () -> new Invoice(); // default Invoice() constructor
        Invoice invoice1 = obj3.get();

        // method reference
        Supplier<Invoice> obj4 = Invoice::new;
        Invoice invoice2 = obj4.get();

    }

}

class Invoice {

    String no;
    BigDecimal unitPrice;
    Integer qty;

    public Invoice() {
    }

    //... generated by IDE
} 
```

4.2 å¯¹æ¥å—å‚æ•°çš„æ„é€ å‡½æ•°çš„å¼•ç”¨â€”`Invoice(BigDecimal unitPrice)`

Java8MethodReference4b.java

```
 package com.mkyong;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.function.Function;

public class Java8MethodReference4b {

    public static void main(String[] args) {

        List<BigDecimal> list = Arrays.asList(
                BigDecimal.valueOf(9.99),
                BigDecimal.valueOf(2.99),
                BigDecimal.valueOf(8.99));

        // lambda
        // List<Invoice> invoices = fakeInvoice(list, (price) -> new Invoice(price));

        // method reference
        List<Invoice> invoices = fakeInvoice(list, Invoice::new);

        invoices.forEach(System.out::println);
    }

    static List<Invoice> fakeInvoice(List<BigDecimal> list, Function<BigDecimal, Invoice> func) {
        List<Invoice> result = new ArrayList<>();

        for (BigDecimal amount : list) {
            result.add(func.apply(amount));
        }
        return result;
    }

}

class Invoice {

    String no;
    BigDecimal unitPrice;
    Integer qty;

    public Invoice(BigDecimal unitPrice) {
        this.unitPrice = unitPrice;
    }

    //... generated by IDE
} 
```

è¾“å‡º

```
 Invoice{no='null', unitPrice=9.99, qty=null}
Invoice{no='null', unitPrice=2.99, qty=null}
Invoice{no='null', unitPrice=8.99, qty=null} 
```

å®Œæˆäº†ã€‚

## å‚è€ƒ

*   [Java 8 æ–¹æ³•å‚è€ƒ:å¦‚ä½•ä½¿ç”¨](http://web.archive.org/web/20220801141236/https://www.codementor.io/@eh3rrera/using-java-8-method-reference-du10866vx)
*   [äº†è§£ Java 8 æ–¹æ³•å¼•ç”¨](http://web.archive.org/web/20220801141236/http://moandjiezana.com/blog/2014/understanding-method-references/)
*   [Î»è¡¨è¾¾å¼çš„ç¿»è¯‘](http://web.archive.org/web/20220801141236/http://cr.openjdk.java.net/~briangoetz/lambda/lambda-translation.html)
*   [Java æ•™ç¨‹â€“æ–¹æ³•å‚è€ƒ](http://web.archive.org/web/20220801141236/https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html)
*   [Java 8 æ•™ç¨‹](/web/20220801141236/https://mkyong.com/tutorials/java-8-tutorials/)
*   [Java 8 å‡½æ•°ç¤ºä¾‹](/web/20220801141236/https://mkyong.com/java8/java-8-function-examples/)
*   [Java 8 åŒåŠŸèƒ½ç¤ºä¾‹](/web/20220801141236/https://mkyong.com/java8/java-8-bifunction-examples/)
*   [Java 8 è°“è¯ç¤ºä¾‹](/web/20220801141236/https://mkyong.com/java8/java-8-predicate-examples/)
*   [Java 8 åŒé¢„æµ‹ç¤ºä¾‹](/web/20220801141236/https://mkyong.com/java8/java-8-bipredicate-examples/)
*   [Java 8 ä¾›åº”å•†ç¤ºä¾‹](/web/20220801141236/https://mkyong.com/java8/java-8-supplier-examples/)

<input type="hidden" id="mkyong-current-postId" value="15538">